
# План тестирования CompactURL

## Введение

Этот документ описывает сценарии проверки системы для демонстрации (Demo).
Мы фокусируемся на **ручном тестировании** пользовательских сценариев и **автоматизированной проверке** сложных архитектурных механизмов (шардирование, нагрузка).

**Окружение:**
- Docker Compose Cluster (Nginx, 2x API, 1x Router, ID Gen).
- База данных: SQLite (Persistent Volume).

---

## 1. Функциональное тестирование

*Проверка бизнес-логики через браузер. Демонстрирует работу системы глазами пользователя.*

### Тест 1.1: Успешное сокращение и редирект
**Цель:** Проверить основной сценарий использования.
**Шаги:**
1.  Открыть `http://localhost`.
2.  Ввести валидный URL: `https://www.wikipedia.org`.
3.  Нажать кнопку **"Сократить"**.
4.  Убедиться, что появилась короткая ссылка (например, `http://localhost/1c`).
5.  Скопировать ссылку, открыть её в новой вкладке.
**Ожидаемый результат:**
-   Происходит перенаправление на Википедию.
-   Интерфейс не завис, анимация работает.

### Тест 1.2: Обработка ошибок
**Цель:** Проверить реакцию системы на некорректные действия.
**Шаги:**
1.  **Пустой ввод:** Оставить поле пустым и нажать "Сократить".
    *   *Ожидание:* Красное сообщение об ошибке (валидация на клиенте или 422 от сервера).
2.  **Несуществующая ссылка:** Ввести в адресную строку `http://localhost/im_not_exist`.
    *   *Ожидание:* Браузер показывает JSON с ошибкой `{"detail": "Link not found..."}` или страницу 404 (не 500!).

---

## 2. Архитектурное тестирование

*Проверка механизмов распределения данных и отказоустойчивости.*

### Тест 2.1: Динамическое шардирование
**Инструмент:** `python3 services/tests/test_sharding.py`
**Предусловие:** `SHARD_LIMIT=1000` (установлен в docker-compose).
**Сценарий:**
1.  Запустить скрипт, который генерирует 2500 ссылок.
2.  Скрипт проверяет наличие файлов `shard_0.db`, `shard_1.db` и т.д. в папке данных.
**Ожидаемый результат:**
-   Скрипт завершается сообщением `✅ PASS`.
-   В папке `services/data` создано несколько файлов БД.

### Тест 2.2: Персистентность
**Инструмент:** Ручная проверка + Консоль.
**Сценарий:**
1.  Выполнить Тест 1.1 (создать ссылку).
2.  В терминале выполнить перезагрузку: `docker compose restart`.
3.  Попробовать перейти по созданной ссылке снова.
**Ожидаемый результат:**
-   Ссылка по-прежнему работает (данные сохранились на диске).

---

## 3. Нагрузочное тестирование

*Проверка производительности с имитацией роста нагрузки (Ramp-up).*

### Тест 3.1: Постепенная нагрузка
**Инструмент:** `python3 services/tests/stress_test.py`
**Сценарий:**
1.  Скрипт запускает виртуальных пользователей.
2.  Нагрузка растет линейно (Ramp-up) в течение 10 секунд до 50 одновременных потоков.
3.  Общее количество запросов: 2500.
**Ожидаемый результат:**
-   Система обрабатывает поток запросов без падений.
-   Ошибки `500 Internal Server Error` отсутствуют.
-   Возможен небольшой процент `503 Service Unavailable` (штатная работа механизма защиты от перегрузки), но система остается живой.
