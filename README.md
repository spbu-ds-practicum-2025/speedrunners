
# «CompactURL» (Распределённый сервис сокращения ссылок)

## Описание

Прототип высоконагруженного распределённого веб-сервиса для сокращения длинных URL-адресов. Проект демонстрирует решение задачи горизонтального масштабирования хранилища данных.

Система реализует механизм **динамического шардирования** (Range-Based Sharding) базы данных SQLite, использует **ID Generator** с пакетной выдачей идентификаторов для минимизации сетевых задержек и обеспечивает отказоустойчивость за счет балансировки нагрузки и кластеризации API.

## Структура проекта

```
.
├── nginx/                      # Конфигурация балансировщика нагрузки (Ingress Layer)
├── services/                   # Микросервисы системы
│   ├── api_service/            # Public API (FastAPI, Frontend UI, In-memory ID Buffer)
│   ├── id_service/             # ID Generator (Stateful сервис выдачи диапазонов)
│   ├── router_service/         # Router Service (Логика шардирования и управления SQLite)
│   ├── data/                   # Volume для физического хранения файлов шардов (.db)
│   └── tests/                      # Скрипты для тестирования данных
├── docs/                       # ТР (техническое решение), архитектура
├── .github/                    # Шаблоны задач и настройки CI/CD
├── docker-compose.yml          # Конфигурация для локального запуска

```

Каждый сервис в `services/` содержит:
- `Dockerfile` — конфигурация контейнера.
- `requirements.txt` — список зависимостей Python.
- Исходный код (`main.py` и вспомогательные модули).

## Быстрый старт

### Предварительные требования

- Docker 24+
- Docker Compose
- Git
- Python 3.11+ (для локального запуска тестовых скриптов)

### Локальный запуск

1. Склонируйте репозиторий:
   ```bash
   git clone https://github.com/spbu-ds-practicum-2025/speedrunners.git
   cd speedrunners
   ```

2. Соберите и запустите кластер:
   ```bash
   docker compose -f 'docker-compose.yml' up -d --build  
   ```

3. Откройте веб-интерфейс в браузере:
   ```
   http://localhost
   ```

4. Проверка работоспособности (Smoke Test):
   ```bash
   python3 ./services/tests/smoke_test.py
   ```

5. Запуск нагрузочного тестирования (Stress Test):
   *Проверяет конкурентную запись в БД (50 потоков, 2500 запросов).*
   ```bash
   python3 services/tests/stress_test.py
   ```

### Остановка системы

Остановка контейнеров:
```bash
docker compose down
```

**Полная очистка** (удаление контейнеров и сброс базы данных):
```bash
docker compose down
# Внимание: это удалит все сохраненные ссылки!
rm -rf services/data/*
```

## Как работать

1. Создайте ветку от `main`.
2. Пишите код в `services/<service>/`.
3. Если меняете архитектуру — обновляйте `docs/tr.md`.
4. Делайте PR в `main` — используйте шаблон PR.

## Требования к PR (минимум)

- Понятное описание изменений.
- Обновлённые `docs` при архитектурных изменениях.
- Проект запускается локально и проходит `smoke_test.py`.